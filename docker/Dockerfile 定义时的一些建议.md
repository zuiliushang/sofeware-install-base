# Dockerfile 定义时的一些建议

## Dockerfile 定义时的一些建议

### 生成或销毁容器的耗时应该是短暂的(越短越好)

生成或者销毁容器的时候越短越好,这样能够在启动一个新的容器替代时所花费的配置和设置尽可能最小化。

### 使用 .dockerignore file

在编写Dockerfile时,最好只将创建docker容器所需要的资源和Dockerfile文件一起放入一个空文件夹。如果有些目录不需要扫描,那么写入 ```.dockerignore``` 即可。这样能够有效的提升```build```性能。

### 避免没必要的安装包

这个没啥可说。

### 每一个容器只有一个注重点

这个很容易理解,越简单的东西越容易维护。所以创建容器的时候尽量减少容器的复杂性。

而且将业务程序多级分解,更能够实现重用、伸缩。

```“one process per container”```一个进程 一个容器虽然并不是必须。但是最重要的是 ```一个模块一个容器```!

### 最小化层数

找到Dockerfile的可读性(和长期可维护性)之间的平衡并尽量减少它使用的层数。对你使用的层数要有策略和谨慎。

### 多行参数排序

在执行到如:
<pre>
RUN apt-get update && apt-get install -y bzr bzr bzr mercurial subversion
</pre>

这种写法会更好:
<pre>
RUN apt-get update && apt-get install -y \
  bzr \
  cvs \
  git \
  mercurial \
  subversion
</pre>

原因不用我多说(老夫就是高冷XD)。

### 建立缓存

在使用Dockerfile创建容器过程中需要用到的镜像,Docker会先从已有的镜像中寻找。有的话就重用。
如果不需要镜像使用 ```--no-cache=true```

Docker 寻找镜像缓存的规则如下:

- 先从已经存在的父镜像找,然后找它的子镜像比较,查看其中一个映像是否使用完全相同的指令构建。否则,缓存将失效.


- 在大多数情况下，仅仅将Dockerfile中的指令与其中一个子映像进行比较就足够了。然而，某些指令需要更多的检查和解释。


- 对于```ADD```和```COPY```指令。将检查```image```文件的内容,并为每个文件计算校验和(不包括文件的最后修改和最后访问次数)。将校验和和镜像中的校验和比较,如果不同,那么缓存就会失效。


- 除了```ADD```和```COPY```之外不会查看容器中的文件来确定缓存匹配。如当处理运行的```apt - get - y update```容器中更新的文件将不会被检查而只使用命令字符串来查找匹配项。

